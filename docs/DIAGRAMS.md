# Chat SDK - Architecture Diagrams

## 1. High-Level System Architecture

```
┌─────────────────────────────────────────────────────────────────────┐
│                         CLIENT APPLICATIONS                          │
│                                                                      │
│  ┌──────────┐  ┌──────────┐  ┌──────────┐  ┌──────────┐           │
│  │   Web    │  │  React   │  │  Mobile  │  │ Flutter  │           │
│  │   App    │  │  Native  │  │iOS/Andr. │  │   App    │           │
│  └────┬─────┘  └────┬─────┘  └────┬─────┘  └────┬─────┘           │
└───────┼─────────────┼─────────────┼─────────────┼──────────────────┘
        │             │             │             │
        └─────────────┴─────────────┴─────────────┘
                      │
                      │ HTTPS/WSS
                      │
        ┌─────────────▼─────────────────────────────┐
        │         API GATEWAY / LOAD BALANCER        │
        │                                            │
        │  • Rate Limiting                           │
        │  • SSL Termination                         │
        │  • Request Routing                         │
        │  • Authentication                          │
        └─────────────┬─────────────────────────────┘
                      │
        ┌─────────────┴─────────────────────────────┐
        │                                            │
┌───────▼────────┐                    ┌─────────────▼──────────┐
│  REST API      │                    │  WebSocket Server      │
│  Server        │                    │  (Real-time)           │
│                │                    │                        │
│ • User Mgmt    │◄───────┐          │ • Message Broadcasting │
│ • Channels     │        │          │ • Presence Tracking    │
│ • Messages     │        │          │ • Typing Indicators    │
│ • Media Upload │        │          │ • Connection Pool      │
└───────┬────────┘        │          └─────────────┬──────────┘
        │                 │                        │
        │                 │                        │
        └─────────────────┼────────────────────────┘
                          │
        ┌─────────────────▼─────────────────────────┐
        │         BUSINESS LOGIC LAYER               │
        │                                            │
        │  • Message Processing                      │
        │  • Channel Management                      │
        │  • Permissions & ACL                       │
        │  • Event Publishing                        │
        └─────────────┬─────────────────────────────┘
                      │
        ┌─────────────┴─────────────────────────────┐
        │                                            │
┌───────▼────────┐  ┌──────────┐  ┌────────────────▼────────┐
│   PostgreSQL   │  │  Redis   │  │   Object Storage (S3)   │
│                │  │          │  │                         │
│ • Users        │  │ • Cache  │  │ • Images                │
│ • Channels     │  │ • Pub/Sub│  │ • Videos                │
│ • Messages     │  │ • Queue  │  │ • Files                 │
│ • Metadata     │  │ • Session│  │ • Attachments           │
└────────────────┘  └──────────┘  └─────────────────────────┘
```

---

## 2. Message Flow Diagram

```
┌─────────┐                                              ┌─────────┐
│ User A  │                                              │ User B  │
└────┬────┘                                              └────┬────┘
     │                                                        │
     │ 1. Send Message                                       │
     ├──────────────────────────────────────────────┐        │
     │                                              │        │
     │                                              ▼        │
     │                                    ┌──────────────────┴────┐
     │                                    │   WebSocket Server    │
     │                                    │                       │
     │                                    │ 2. Validate & Process │
     │                                    └──────────┬────────────┘
     │                                               │
     │                                               │ 3. Save to DB
     │                                               ▼
     │                                    ┌─────────────────────┐
     │                                    │    PostgreSQL       │
     │                                    │                     │
     │                                    │ • Store message     │
     │                                    │ • Update channel    │
     │                                    └──────────┬──────────┘
     │                                               │
     │                                               │ 4. Publish Event
     │                                               ▼
     │                                    ┌─────────────────────┐
     │                                    │    Redis Pub/Sub    │
     │                                    │                     │
     │                                    │ • Broadcast event   │
     │                                    └──────────┬──────────┘
     │                                               │
     │ 5. Delivery Receipt                          │ 6. Deliver Message
     │◄─────────────────────────────────────────────┼──────────────────►
     │                                               │
     │                                               │ 7. Push Notification
     │                                               │    (if offline)
     │                                               ▼
     │                                    ┌─────────────────────┐
     │                                    │  Push Service       │
     │                                    │  (FCM/APNS)         │
     │                                    └─────────────────────┘
```

---

## 3. Authentication Flow

```
┌─────────┐                                              ┌─────────────┐
│ Client  │                                              │   Backend   │
└────┬────┘                                              └──────┬──────┘
     │                                                          │
     │ 1. Request Token (username/password)                    │
     ├─────────────────────────────────────────────────────────►
     │                                                          │
     │                                        2. Validate       │
     │                                           Credentials    │
     │                                                          │
     │                                        3. Generate JWT   │
     │                                                          │
     │ 4. Return Token                                          │
     │◄─────────────────────────────────────────────────────────┤
     │                                                          │
     │ 5. Connect to WebSocket (with token)                    │
     ├─────────────────────────────────────────────────────────►
     │                                                          │
     │                                        6. Validate Token │
     │                                                          │
     │ 7. Connection Established                                │
     │◄─────────────────────────────────────────────────────────┤
     │                                                          │
     │ 8. Subscribe to Channels                                 │
     ├─────────────────────────────────────────────────────────►
     │                                                          │
     │ 9. Receive Real-time Events                              │
     │◄─────────────────────────────────────────────────────────┤
     │                                                          │
```

---

## 4. SDK Architecture

```
┌─────────────────────────────────────────────────────────────────┐
│                        APPLICATION LAYER                         │
│                                                                  │
│  ┌──────────────┐  ┌──────────────┐  ┌──────────────┐         │
│  │   React UI   │  │   Vue UI     │  │  Angular UI  │         │
│  │  Components  │  │  Components  │  │  Components  │         │
│  └──────┬───────┘  └──────┬───────┘  └──────┬───────┘         │
└─────────┼──────────────────┼──────────────────┼────────────────┘
          │                  │                  │
          └──────────────────┴──────────────────┘
                             │
┌────────────────────────────▼─────────────────────────────────────┐
│                    FRAMEWORK ADAPTERS                             │
│                                                                   │
│  ┌──────────────┐  ┌──────────────┐  ┌──────────────┐          │
│  │ React Hooks  │  │ Vue Compos.  │  │ Angular Srv. │          │
│  │ • useChat    │  │ • useChat    │  │ • ChatService│          │
│  │ • useChannel │  │ • useChannel │  │ • ChannelSrv │          │
│  │ • useMessages│  │ • useMessages│  │ • MessageSrv │          │
│  └──────┬───────┘  └──────┬───────┘  └──────┬───────┘          │
└─────────┼──────────────────┼──────────────────┼──────────────────┘
          │                  │                  │
          └──────────────────┴──────────────────┘
                             │
┌────────────────────────────▼─────────────────────────────────────┐
│                        CORE SDK                                   │
│                                                                   │
│  ┌─────────────────────────────────────────────────────────┐    │
│  │                    ChatClient                            │    │
│  │  • connect()  • disconnect()  • getUser()               │    │
│  └─────────────────────────────────────────────────────────┘    │
│                                                                   │
│  ┌──────────────┐  ┌──────────────┐  ┌──────────────┐          │
│  │   Auth       │  │   Channels   │  │   Messages   │          │
│  │  Module      │  │   Module     │  │   Module     │          │
│  └──────┬───────┘  └──────┬───────┘  └──────┬───────┘          │
│         │                  │                  │                  │
│  ┌──────▼──────────────────▼──────────────────▼───────┐         │
│  │              Connection Manager                     │         │
│  │  • WebSocket  • Reconnection  • Heartbeat          │         │
│  └──────┬──────────────────────────────────────────────┘         │
│         │                                                         │
│  ┌──────▼──────────────────────────────────────────────┐         │
│  │              State Manager                           │         │
│  │  • Local Cache  • Event Emitter  • Sync Queue      │         │
│  └─────────────────────────────────────────────────────┘         │
└───────────────────────────────────────────────────────────────────┘
                             │
                             │
┌────────────────────────────▼─────────────────────────────────────┐
│                    NETWORK LAYER                                  │
│                                                                   │
│  ┌──────────────┐  ┌──────────────┐  ┌──────────────┐          │
│  │   HTTP       │  │  WebSocket   │  │   Storage    │          │
│  │   Client     │  │   Client     │  │   Client     │          │
│  └──────────────┘  └──────────────┘  └──────────────┘          │
└───────────────────────────────────────────────────────────────────┘
```

---

## 5. Database Schema Relationships

```
┌─────────────────┐
│  applications   │
│  ─────────────  │
│  • id (PK)      │
│  • name         │
│  • api_key      │
│  • plan_id (FK) │
└────────┬────────┘
         │
         │ 1:N
         │
┌────────▼────────┐         ┌─────────────────┐
│     users       │         │    channels     │
│  ─────────────  │         │  ─────────────  │
│  • id (PK)      │         │  • id (PK)      │
│  • app_id (FK)  │         │  • app_id (FK)  │
│  • username     │         │  • type         │
│  • email        │         │  • name         │
│  • is_online    │         │  • created_by   │
└────────┬────────┘         └────────┬────────┘
         │                           │
         │ N:M                       │
         │                           │
         │    ┌──────────────────┐   │
         └────►channel_members   │◄──┘
              │  ──────────────  │
              │  • id (PK)       │
              │  • channel_id(FK)│
              │  • user_id (FK)  │
              │  • role          │
              │  • unread_count  │
              └────────┬─────────┘
                       │
                       │ 1:N
                       │
              ┌────────▼─────────┐
              │    messages      │
              │  ──────────────  │
              │  • id (PK)       │
              │  • channel_id(FK)│
              │  • user_id (FK)  │
              │  • text          │
              │  • attachments   │
              └────────┬─────────┘
                       │
                       │ 1:N
                       │
         ┌─────────────┴─────────────┐
         │                           │
┌────────▼────────┐      ┌───────────▼──────┐
│message_reactions│      │  message_reads   │
│  ──────────────│      │  ──────────────  │
│  • id (PK)      │      │  • id (PK)       │
│  • message_id(FK)│     │  • message_id(FK)│
│  • user_id (FK) │      │  • user_id (FK)  │
│  • emoji        │      │  • read_at       │
└─────────────────┘      └──────────────────┘
```

---

## 6. Deployment Architecture

```
┌─────────────────────────────────────────────────────────────────┐
│                         AWS CLOUD                                │
│                                                                  │
│  ┌────────────────────────────────────────────────────────┐    │
│  │                    Route 53 (DNS)                       │    │
│  └───────────────────────────┬────────────────────────────┘    │
│                              │                                  │
│  ┌───────────────────────────▼────────────────────────────┐    │
│  │              CloudFront (CDN)                           │    │
│  └───────────────────────────┬────────────────────────────┘    │
│                              │                                  │
│  ┌───────────────────────────▼────────────────────────────┐    │
│  │          Application Load Balancer (ALB)                │    │
│  └───────────────────────────┬────────────────────────────┘    │
│                              │                                  │
│  ┌───────────────────────────▼────────────────────────────┐    │
│  │                  EKS Cluster                            │    │
│  │                                                         │    │
│  │  ┌──────────────┐  ┌──────────────┐  ┌─────────────┐ │    │
│  │  │  API Server  │  │  WebSocket   │  │   Worker    │ │    │
│  │  │   Pods (3+)  │  │  Server      │  │   Pods      │ │    │
│  │  │              │  │  Pods (3+)   │  │   (Jobs)    │ │    │
│  │  └──────┬───────┘  └──────┬───────┘  └──────┬──────┘ │    │
│  └─────────┼──────────────────┼──────────────────┼────────┘    │
│            │                  │                  │              │
│  ┌─────────▼──────────────────▼──────────────────▼────────┐    │
│  │                    Service Mesh                         │    │
│  └─────────┬──────────────────┬──────────────────┬────────┘    │
│            │                  │                  │              │
│  ┌─────────▼────────┐  ┌──────▼──────┐  ┌───────▼────────┐    │
│  │  RDS PostgreSQL  │  │ ElastiCache │  │      S3        │    │
│  │   (Multi-AZ)     │  │   (Redis)   │  │  (Storage)     │    │
│  │                  │  │             │  │                │    │
│  │  • Primary       │  │  • Cluster  │  │  • Media files │    │
│  │  • Standby       │  │  • Replicas │  │  • Backups     │    │
│  └──────────────────┘  └─────────────┘  └────────────────┘    │
│                                                                  │
│  ┌──────────────────────────────────────────────────────────┐  │
│  │              Supporting Services                          │  │
│  │                                                           │  │
│  │  ┌──────────┐  ┌──────────┐  ┌──────────┐  ┌─────────┐ │  │
│  │  │CloudWatch│  │  SNS/SQS │  │Elasticsearch│ │ Secrets │ │  │
│  │  │(Monitor) │  │(Messaging)│  │  (Search) │  │ Manager │ │  │
│  │  └──────────┘  └──────────┘  └──────────┘  └─────────┘ │  │
│  └──────────────────────────────────────────────────────────┘  │
└──────────────────────────────────────────────────────────────────┘
```

---

## 7. Scaling Strategy

```
┌─────────────────────────────────────────────────────────────────┐
│                    HORIZONTAL SCALING                            │
│                                                                  │
│  Load Increases ──────────────────────────────────────►         │
│                                                                  │
│  ┌──────────┐  ┌──────────┐  ┌──────────┐  ┌──────────┐       │
│  │ Server 1 │  │ Server 2 │  │ Server 3 │  │ Server N │       │
│  │          │  │          │  │          │  │          │       │
│  │ 1K users │  │ 1K users │  │ 1K users │  │ 1K users │       │
│  └────┬─────┘  └────┬─────┘  └────┬─────┘  └────┬─────┘       │
│       │             │             │             │              │
│       └─────────────┴─────────────┴─────────────┘              │
│                     │                                           │
│            ┌────────▼────────┐                                  │
│            │  Redis Pub/Sub  │                                  │
│            │  (Message Bus)  │                                  │
│            └─────────────────┘                                  │
│                                                                  │
│  Benefits:                                                       │
│  • Each server handles subset of connections                    │
│  • Redis coordinates cross-server communication                 │
│  • Add/remove servers based on load                             │
│  • No single point of failure                                   │
└──────────────────────────────────────────────────────────────────┘
```

---

## 8. Data Flow - Real-time Events

```
User A Types                                        User B Receives
    │                                                      │
    │ 1. typing.start                                     │
    ├──────────────────────────────────┐                  │
    │                                  │                  │
    │                                  ▼                  │
    │                      ┌───────────────────┐          │
    │                      │  WebSocket Server │          │
    │                      │                   │          │
    │                      │ 2. Validate user  │          │
    │                      │    in channel     │          │
    │                      └─────────┬─────────┘          │
    │                                │                    │
    │                                │ 3. Publish event   │
    │                                ▼                    │
    │                      ┌───────────────────┐          │
    │                      │   Redis Pub/Sub   │          │
    │                      │                   │          │
    │                      │ Channel: typing   │          │
    │                      └─────────┬─────────┘          │
    │                                │                    │
    │                                │ 4. Broadcast       │
    │                                ▼                    │
    │                      ┌───────────────────┐          │
    │                      │  All WS Servers   │          │
    │                      │                   │          │
    │                      │ 5. Filter by      │          │
    │                      │    channel members│          │
    │                      └─────────┬─────────┘          │
    │                                │                    │
    │                                │ 6. Send to User B  │
    │                                └────────────────────┤
    │                                                     │
    │                                                     ▼
    │                                          User B sees typing
```

This comprehensive set of diagrams should help visualize the entire Chat SDK architecture!
